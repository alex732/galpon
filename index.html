/* ================= LÓGICA DE VIDEO TIPO P2P ================= */
const IP  = "192.168.2.193:88";
const USR = "alex";
const PWD = "F7324088";

// Forzamos a Chrome a NO usar SSL (HTTPS)
function activarVideo() {
    const streamImg = document.getElementById("foscam-stream");
    const btn = document.getElementById("btn-play");
    const loadTxt = document.getElementById("load-txt");

    // URL de comando base
    const baseHttp = "http://" + IP + "/cgi-bin/CGIProxy.fcgi?usr=" + USR + "&pwd=" + PWD;

    // Abrimos ventana de autorización en una pestaña limpia
    const authWin = window.open(baseHttp + "&cmd=getDevState", "_blank");

    alert("PASO CRÍTICO:\nEn la pestaña que se abrió, si Chrome dice 'No se puede conectar', revisa que la dirección NO tenga 'https'. Debe ser http://192.168.2.193:88");

    setTimeout(() => {
        streamImg.style.display = "block";
        loadTxt.style.display = "none";
        
        // Simulación de flujo P2P mediante refresco de paquetes Snapshot
        setInterval(() => {
            // El timestamp (_ts) obliga a Chrome a pedir un paquete nuevo cada vez
            streamImg.src = baseHttp + "&cmd=snapShot&_ts=" + Date.now();
        }, 1000);

        btn.innerText = "✅ CONEXIÓN P2P SIMULADA";
        btn.style.background = "#22c55e";
    }, 3000);
}
