<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zentinel AI Cloud</title>
    <style>
        body{background:#0f172a; color:#f8fafc; font-family:'Segoe UI',sans-serif; margin:0; padding:10px; font-size:13px;}
        .header-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; border-bottom: 1px solid #334155; padding-bottom: 5px; }
        .header-title { font-size: 20px; font-weight: 800; } .header-clock { color: #94a3b8; font-family: monospace; }
        
        .layout-grid { display: grid; grid-template-columns: 180px 1fr 280px; gap: 10px; }
        
        /* ESTILOS DE MATRIZ 3D ID√âNTICOS A v219 */
        .matrix-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 0px; margin-top: 5px; width: 100%; box-sizing: border-box; border: 2px solid #334155; }
        .cam-cell { background: #000; height: 45px; position: relative; border: 0.5px solid #1e293b; overflow: hidden; width: 100%; box-sizing: border-box; cursor: pointer; transition: 0.2s; display: flex; align-items: center; justify-content: center; }
        .cam-cell:hover { z-index: 10; transform: scale(1.2); border: 1px solid #38bdf8; }
        .cam-tag { position: absolute; bottom: 0; width: 100%; background: rgba(0,0,0,0.5); font-size: 8px; text-align: center; color: white; padding:1px; }
        .cam-icon { font-size: 20px; opacity: 0.7; }

        .card { background: #1e293b; border: 1px solid #334155; border-radius: 6px; padding: 8px; margin-bottom: 8px; }
        .card-title { font-size: 10px; color: #38bdf8; font-weight: 800; margin-bottom: 5px; text-transform: uppercase; border-bottom: 1px solid #334155; }
        .gauge-box { background: #0f172a; border-radius: 50%; width: 100px; height: 100px; display: flex; flex-direction: column; align-items: center; justify-content: center; margin: 0 auto 5px auto; border: 4px solid #334155; transition: 0.5s; }
        .g-green { border-color: #22c55e; color: #4ade80; } .g-red { border-color: #ef4444; color: #f87171; }
        .val-text { font-size: 22px; font-weight: bold; } .lbl-text { font-size: 8px; color: #94a3b8; }
        
        .video-main { width: 100%; height: 380px; background: #000; border-radius: 6px; object-fit: cover; border: 1px solid #334155; }
        
        .chat-container { height: 180px; display: flex; flex-direction: column; background: #0f172a; border-radius: 6px; border: 1px solid #334155; overflow: hidden; }
        .chat-log { flex: 1; padding: 10px; color: #94a3b8; font-size:11px; text-align:center; display:flex; align-items:center; justify-content:center;}
        
        /* CLIMA VISUAL v219 */
        .pred-box { background:#0f172a; border-left:4px solid #38bdf8; padding:5px; font-size:12px; color:#e2e8f0; margin-top:10px; min-height: 80px; border-radius: 4px; display:flex; align-items:center; gap:10px; }
        .w-thumb { width:70px; height:70px; object-fit:cover; border-radius:4px; border:1px solid #334155; cursor:pointer; }
        .w-text { flex:1; }

        .banner-neutral { background:#1e293b; color:#94a3b8; padding:10px; border-radius:4px; font-weight:bold; text-align:center; border:1px solid #334155; }
        .banner-safe { background:#064e3b; color:#34d399; padding:10px; border-radius:4px; font-weight:bold; text-align:center; border:1px solid #059669; }
        .banner-danger { background:#450a0a; color:#f87171; padding:10px; border-radius:4px; font-weight:bold; text-align:center; border:1px solid #ef4444; animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0.5; } }

        .pi-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 3px; }
        .stat-box { background: #0f172a; padding: 4px; border-radius: 3px; text-align: center; border: 1px solid #334155; font-size: 9px; }
        .stat-val { color: #38bdf8; font-weight: bold; }
        
        /* MODAL ZOOM */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.9); align-items: center; justify-content: center; }
        .modal-content { max-width: 90%; max-height: 90%; border: 2px solid #38bdf8; border-radius: 8px; box-shadow: 0 0 20px rgba(56, 189, 248, 0.5); }
        .close { position: absolute; top: 15px; right: 35px; color: #f1f1f1; font-size: 40px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<div id="myModal" class="modal" onclick="document.getElementById('myModal').style.display='none'"><span class="close">&times;</span><img class="modal-content" id="img01"></div>

<div class="header-bar">
    <div class="header-title">ZENTINEL <span style="color:#38bdf8">CLOUD</span></div>
    <div id="clock" class="header-clock">--:--</div>
</div>

<div class="layout-grid">
  <div class="col-left">
    <div class="card"><div class="card-title">SENSORES</div>
        <div id="bgT" class="gauge-box"><span id="vT" class="val-text">--</span><span class="lbl-text">TEMP</span></div>
        <div id="bgH" class="gauge-box"><span id="vH" class="val-text">--</span><span class="lbl-text">HUM</span></div>
        <div id="bgN" class="gauge-box"><span id="vN" class="val-text">--</span><span class="lbl-text">NH3</span></div>
        <div id="bgR" class="gauge-box"><span id="vR" style="font-size:30px;">‚òÄÔ∏è</span><span id="lR" class="lbl-text">SECO</span></div>
    </div>
    <div class="card">
        <div class="card-title">AN√ÅLISIS CLIM√ÅTICO</div>
        <div class="pred-box">
            <img id="w-img" src="" class="w-thumb" onclick="showImg(this.src)">
            <div id="wp" class="w-text">Conectando...</div>
        </div>
    </div>
  </div>

  <div class="col-center">
    <div id="banner-ia" class="banner-neutral">Conectando a Firebase...</div>
    <img id="live" class="video-main" src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=">
    
    <div id="matrix" class="matrix-grid"></div>

    <div class="card" style="margin-top:10px;">
        <div class="card-title">CHAT CON INTELIGENCIA ARTIFICIAL</div>
        <div class="chat-container"><div class="chat-log">Chat disponible solo en versi√≥n local</div></div>
    </div>
  </div>

  <div class="col-right">
    <div class="card"><div class="card-title">ESTADO DEL SISTEMA</div>
      <div class="pi-grid">
          <div class="stat-box"><span id="ts" class="stat-val">--</span><br>SYNC</div>
          <div class="stat-box"><span id="mot" class="stat-val">--</span><br>MOTOR</div>
          <div class="stat-box"><span style="color:#22c55e">ONLINE</span><br>STATUS</div>
      </div>
    </div>
    <div class="card"><div class="card-title">VIENTO</div><iframe width="100%" height="130" src="https://embed.windy.com/embed2.html?lat=19.7&lon=-70.7&zoom=7&overlay=wind" frameborder="0"></iframe></div>
    <div class="card"><div class="card-title">RADAR</div><iframe width="100%" height="170" src="https://radar-met2.sna.gob.do/" frameborder="0"></iframe></div>
  </div>
</div>

<script>
    // üî• PON AQU√ç TU URL DE FIREBASE (Terminada en .json)
    const DB_URL = "https://TU-PROYECTO.firebaseio.com/zentinel.json";

    function showImg(src){ 
        if(!src || src.length < 100) return; 
        document.getElementById('myModal').style.display='flex'; 
        document.getElementById('img01').src=src; 
    }

    function setG(id, v, max) { 
        let el=document.getElementById('v'+id); 
        let bg=document.getElementById('bg'+id); 
        el.innerText=v; 
        bg.className='gauge-box '+(parseFloat(v)>max?'g-red':'g-green'); 
    }

    // Generar Matriz vac√≠a al inicio
    const matrixEl = document.getElementById('matrix');
    let matrixHTML = "";
    for(let y=0; y<4; y++){
        for(let x=0; x<6; x++){
            matrixHTML += `<div id="c_${y}_${x}" class="cam-cell" onclick="verLive()"><div class="cam-tag">F${y}_C${x}</div><div class="cam-icon">üì∑</div></div>`;
        }
    }
    matrixEl.innerHTML = matrixHTML;

    function verLive(){
        // Al hacer click en matriz web, mostramos la imagen principal (Live Feed)
        // Ya que no subimos 24 fotos individuales a la nube por peso.
        let img = document.getElementById('live').src;
        showImg(img);
    }

    async function sync() {
        try {
            const res = await fetch(DB_URL);
            const d = await res.json();
            if(d) {
                // Sensores
                setG('T', d.t, 30); setG('H', d.h, 75); setG('N', d.n, 20);
                document.getElementById('vR').innerText = d.r=='SI'?'‚õàÔ∏è':'‚òÄÔ∏è';
                document.getElementById('ts').innerText = d.ts;
                document.getElementById('mot').innerText = d.mot;
                
                // Clima
                document.getElementById('wp').innerText = d.weather;
                if(d.w_img) document.getElementById('w-img').src = "data:image/jpeg;base64," + d.w_img;

                // Banner
                const ban = document.getElementById('banner-ia');
                // Convertir HTML local a Clases CSS simples
                if(d.banner.includes("danger")) ban.className = "banner-danger";
                else if(d.banner.includes("safe")) ban.className = "banner-safe";
                else ban.className = "banner-neutral";
                ban.innerHTML = d.banner;

                // Imagen Principal
                if(d.img) document.getElementById('live').src = "data:image/jpeg;base64," + d.img;

                // Actualizar Colores Matriz
                if(d.matrix) {
                    for (const [key, color] of Object.entries(d.matrix)) {
                        // key viene como "F0_C0", en HTML es "c_0_0"
                        let idHTML = "c_" + key.replace("F","").replace("_C","_");
                        let celda = document.getElementById(idHTML);
                        if(celda) {
                            celda.style.border = "2px solid " + color;
                            celda.style.backgroundColor = (color === "#ef4444") ? "rgba(239,68,68,0.2)" : "rgba(0,0,0,0.5)";
                        }
                    }
                }
            }
        } catch(e) { console.log(e); }
    }

    setInterval(sync, 2000);
    sync();
    
    // Reloj local
    setInterval(() => {
        document.getElementById('clock').innerText = new Date().toLocaleTimeString();
    }, 1000);
</script>
</body>
</html>
