<!DOCTYPE html>
<html lang='es'>
<head>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <title>Zentinel Cloud üá©üá¥</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        body{background:#0f172a;color:#f8fafc;font-family:'Segoe UI';margin:0;padding:10px}
        .header-bar{display:flex;justify-content:space-between;margin-bottom:10px;border-bottom:1px solid #334155}
        .header-title{font-size:20px;font-weight:bold}
        .layout-grid{display:grid;gap:10px;grid-template-columns:180px 1fr 300px}
        .card{background:#1e293b;border:1px solid #334155;border-radius:6px;padding:8px;margin-bottom:8px;display:flex;flex-direction:column}
        .card-title{font-size:10px;color:#94a3b8;font-weight:bold;margin-bottom:5px}
        .gauge-box{background:#0f172a;border-radius:50%;width:100px;height:100px;display:flex;flex-direction:column;align-items:center;justify-content:center;margin:0 auto 10px auto;border:4px solid #334155;transition:border-color 0.5s}
        .g-green{border-color:#22c55e}.g-red{border-color:#ef4444}
        .val-text{font-size:22px;font-weight:bold}.lbl-text{font-size:9px;color:#94a3b8}
        .video-main{width:100%;height:350px;background:#000;border-radius:6px;object-fit:cover;border:1px solid #334155}
        .ia-list{height:150px;overflow-y:auto;display:flex;flex-direction:column;gap:5px}
        .ia-item{background:#0f172a;padding:6px;border-radius:4px;border:1px solid #334155;font-size:11px}
        /* üî• CAJA PREDICCI√ìN */
        .pred-box { background:#0f172a; border-left:4px solid #38bdf8; padding:10px; font-size:13px; color:#e2e8f0; margin-top:10px; text-align:center; }
        
        table{width:100%;border-collapse:collapse;font-size:10px} th{text-align:left;border-bottom:1px solid #334155} td{border-bottom:1px solid #33415555}
        .pi-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:3px;font-size:9px}
        .stat-box{background:#0f172a;padding:4px;border-radius:3px;text-align:center;border:1px solid #334155}
        iframe{width:100%;border:none;border-radius:4px;display:block}
    </style>
</head>
<body>
    <div class="header-bar"><div class="header-title">ZENTINEL <span style="color:#38bdf8">CLOUD</span></div><div id="clock">--:--</div></div>
    <div class="layout-grid">
        <div class="col-left"><div class="card">
            <div id="bgT" class="gauge-box"><span id="vT" class="val-text">--</span>TEMP</div>
            <div id="bgH" class="gauge-box"><span id="vH" class="val-text">--</span>HUM</div>
            <div id="bgN" class="gauge-box"><span id="vN" class="val-text">--</span>NH3</div>
            <div id="bgR" class="gauge-box"><span id="vR" style="font-size:30px">‚òÄÔ∏è</span>LLUVIA</div>
            <div class="card-title" style="margin-top:10px">ü§ñ PREDICCI√ìN CLIMA</div>
            <div id="wp" class="pred-box">Cargando...</div>
        </div></div>
        
        <div class="col-center">
            <div class="card" style="border-color:#38bdf8"><div class="card-title">üì¢ AN√ÅLISIS IA ACTUAL</div><div id="current-rec" style="padding:5px;font-size:14px">...</div></div>
            <img id="live" class="video-main" src="" alt="Cargando...">
            <div class="card" style="margin-top:8px;height:150px;overflow-y:auto"><div class="card-title">HISTORIAL LOCAL</div><table id="local-table"><thead><tr><th>HORA</th><th>T</th><th>H</th><th>N</th><th>LLUVIA</th></tr></thead><tbody></tbody></table></div>
        </div>
        
        <div class="col-right">
            <div class="card"><div class="card-title">SISTEMA</div><div class="pi-grid"><div class="stat-box"><span id="piIP">--</span><br>IP</div><div class="stat-box" id="stArd">--<br>ARDUINO</div><div class="stat-box" id="stIA">--<br>IA</div></div></div>
            <div class="card"><div class="card-title">HISTORIAL IA</div><div id="ia-history" class="ia-list"></div></div>
            <div class="card"><div class="card-title">VIENTO</div><iframe height="150" src="https://embed.windy.com/embed2.html?lat=19.780&lon=-70.687&zoom=8&level=surface&overlay=wind"></iframe></div>
            <div class="card"><div class="card-title">RADAR DO</div><iframe height="200" src="https://radar-met2.sna.gob.do/"></iframe></div>
        </div>
    </div>
    <script>
        var firebaseConfig = { databaseURL: "https://zentinel-ia-default-rtdb.firebaseio.com/" };
        firebase.initializeApp(firebaseConfig);
        var ref = firebase.database().ref('zentinel');
        let lastTimestamp = "";

        function setG(id,v,min,max){let bg=document.getElementById('bg'+id);document.getElementById('v'+id).innerText=v;let val=parseFloat(v);bg.className='gauge-box '+(val>max?'g-red':'g-green');}
        
        ref.on('value', (snapshot) => {
            const data = snapshot.val(); if(!data)return;
            setG('T',data.t,28,30); setG('H',data.h,65,75); setG('N',data.n,15,25);
            let isR=data.r=='SI'; document.getElementById('vR').innerText=isR?'‚õàÔ∏è':'‚òÄÔ∏è'; document.getElementById('bgR').className='gauge-box '+(isR?'g-red':'g-green');
            
            // üî• ACTUALIZAR PREDICCI√ìN CLIMA
            document.getElementById('wp').innerText = data.wp || "Sin datos";

            if(data.img) document.getElementById('live').src="data:image/jpeg;base64,"+data.img;
            document.getElementById('current-rec').innerText = data.banner.replace(/<[^>]*>?/gm, '');
            if(data.recs){ let h=""; data.recs.forEach(r=>{h+=`<div class="ia-item">ü§ñ ${r}</div>`}); document.getElementById('ia-history').innerHTML=h; }
            document.getElementById('piIP').innerText=data.piIP||'--';
            document.getElementById('stArd').style.color=data.ard?'#4ade80':'#ef4444';
            document.getElementById('stIA').style.color=data.iaOn?'#4ade80':'#ef4444';
            document.getElementById('clock').innerText=data.ts;

            if(data.ts!==lastTimestamp){ lastTimestamp=data.ts; let t=document.querySelector("#local-table tbody"); t.innerHTML=`<tr><td>${data.ts}</td><td>${data.t}</td><td>${data.h}</td><td>${data.n}</td><td>${data.r}</td></tr>`+t.innerHTML; }
        });
    </script>
</body>
</html>
