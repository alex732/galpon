<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zentinel AI Cloud v240</title>
    <style>
        /* --- DISE√ëO MASTER v239 (INTACTO) --- */
        body { background: #0f172a; color: #f8fafc; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 10px; font-size: 13px; }
        .header-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; border-bottom: 1px solid #334155; padding-bottom: 10px; }
        .header-title { font-size: 24px; font-weight: 800; letter-spacing: 1px; }
        .header-clock { color: #94a3b8; font-family: monospace; font-size: 16px; font-weight: bold; }
        .layout-grid { display: grid; grid-template-columns: 200px 1fr 280px; gap: 15px; }
        .card { background: #1e293b; border: 1px solid #334155; border-radius: 8px; padding: 10px; margin-bottom: 10px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3); }
        .card-title { font-size: 11px; color: #38bdf8; font-weight: 800; margin-bottom: 8px; text-transform: uppercase; border-bottom: 1px solid #334155; padding-bottom: 4px; letter-spacing: 0.5px; }
        .gauge-box { background: #0f172a; border-radius: 50%; width: 90px; height: 90px; display: flex; flex-direction: column; align-items: center; justify-content: center; margin: 0 auto 8px auto; border: 4px solid #334155; transition: 0.3s; }
        .g-green { border-color: #22c55e; color: #4ade80; } .g-red { border-color: #ef4444; color: #f87171; }
        .val-text { font-size: 20px; font-weight: bold; } .lbl-text { font-size: 9px; color: #94a3b8; }
        .video-main { width: 100%; height: 350px; background: #000; border-radius: 6px; object-fit: cover; border: 2px solid #334155; box-shadow: 0 0 15px rgba(0,0,0,0.5); }
        .matrix-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 1px; margin-top: 10px; width: 100%; background: #000; padding: 2px; border-radius: 4px; border: 1px solid #334155; }
        .cam-cell { background: #0f172a; height: 35px; position: relative; overflow: hidden; cursor: pointer; transition: 0.2s; display: flex; align-items: center; justify-content: center; border: 1px solid #1e293b; }
        .cam-cell:hover { transform: scale(1.1); z-index: 10; border-color: #38bdf8; }
        .cam-tag { position: absolute; bottom: 0; width: 100%; background: rgba(0,0,0,0.6); font-size: 8px; text-align: center; color: white; padding:1px; font-weight:bold; }
        .cell-thumb { width: 100%; height: 100%; object-fit: cover; opacity: 0.7; transition: 0.2s; } .cam-cell:hover .cell-thumb { opacity: 1; }
        .pred-box { background: #0f172a; border-left: 4px solid #38bdf8; padding: 8px; font-size: 12px; color: #e2e8f0; margin-top: 10px; min-height: 70px; border-radius: 4px; display: flex; align-items: center; gap: 10px; }
        .w-thumb { width: 60px; height: 60px; object-fit: cover; border-radius: 4px; border: 1px solid #334155; cursor: pointer; } .w-text { flex: 1; line-height: 1.4; }
        .banner-neutral { background: #334155; color: #94a3b8; padding: 10px; border-radius: 4px; font-weight: bold; text-align: center; border: 1px solid #475569; margin-bottom: 10px; }
        .banner-safe { background: #064e3b; color: #34d399; padding: 10px; border-radius: 4px; font-weight: bold; text-align: center; border: 1px solid #059669; margin-bottom: 10px; }
        .banner-danger { background: #450a0a; color: #f87171; padding: 10px; border-radius: 4px; font-weight: bold; text-align: center; border: 1px solid #ef4444; animation: blink 1s infinite; margin-bottom: 10px; }
        @keyframes blink { 50% { opacity: 0.5; } }
        .hist-container { max-height: 180px; overflow-y: auto; display: block; border: 1px solid #334155; border-radius: 4px; }
        .hist-table { width: 100%; border-collapse: collapse; font-size: 11px; }
        .hist-table th { background: #0f172a; color: #38bdf8; padding: 5px; text-align: left; position: sticky; top: 0; border-bottom: 1px solid #334155; }
        .hist-table td { padding: 4px; border-bottom: 1px solid #334155; color: #cbd5e1; }
        .hist-table tr:nth-child(even) { background: #1e293b; } .hist-table tr:hover { background: #334155; }
        ::-webkit-scrollbar { width: 6px; } ::-webkit-scrollbar-track { background: #0f172a; } ::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }
        .pi-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; }
        .stat-box { background: #0f172a; padding: 5px; border-radius: 4px; text-align: center; border: 1px solid #334155; font-size: 10px; }
        .stat-val { color: #38bdf8; font-weight: bold; display: block; margin-bottom: 2px; }
        @media (max-width: 900px) { .layout-grid { grid-template-columns: 1fr; } .video-main { height: 250px; } }
        
        /* üî• FIX ZOOM: Hacer que las miniaturas ocupen el ancho del modal */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.95); align-items: center; justify-content: center; }
        .modal-content { max-width: 90%; max-height: 90%; border: 2px solid #38bdf8; box-shadow: 0 0 30px rgba(56, 189, 248, 0.3); border-radius: 8px; width: 800px; object-fit: contain; background: black; }
        .close { position: absolute; top: 15px; right: 35px; color: #f1f1f1; font-size: 40px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<div id="myModal" class="modal" onclick="this.style.display='none'"><img class="modal-content" id="img01"></div>
<div class="header-bar"><div class="header-title">ZENTINEL <span style="color:#38bdf8">CLOUD</span></div><div id="clock" class="header-clock">--:--</div></div>

<div class="layout-grid">
    <div class="col-left">
        <div class="card"><div class="card-title">SENSORES (PUERTO PLATA)</div><div id="bgT" class="gauge-box"><span id="vT" class="val-text">--</span><span class="lbl-text">TEMP</span></div><div id="bgH" class="gauge-box"><span id="vH" class="val-text">--</span><span class="lbl-text">HUM</span></div><div id="bgN" class="gauge-box"><span id="vN" class="val-text">--</span><span class="lbl-text">NH3</span></div><div id="bgR" class="gauge-box"><span id="vR" style="font-size:24px;">‚òÄÔ∏è</span><span id="lR" class="lbl-text">SECO</span></div></div>
        <div class="card"><div class="card-title">AN√ÅLISIS SATELITAL</div><div class="pred-box"><img id="w-img" src="" class="w-thumb" onclick="verFoto(this.src)"><div id="wp" class="w-text">Cargando datos...</div></div></div>
    </div>

    <div class="col-center">
        <div id="banner-ia" class="banner-neutral">Sincronizando con Raspberry Pi...</div>
        <div style="position:relative"><img id="live" class="video-main" src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" onclick="verFoto(this.src)"><div style="position:absolute;top:10px;right:10px;color:#ef4444;font-weight:bold;font-size:10px;text-shadow:0 0 2px black;">‚óè LIVE</div></div>
        <div class="card" style="margin-top:10px;"><div class="card-title">HISTORIAL DE LECTURAS (SESI√ìN ACTUAL)</div><div class="hist-container"><table class="hist-table"><thead><tr><th>HORA</th><th>TEMP</th><th>HUM</th><th>NH3</th><th>LLUVIA</th></tr></thead><tbody id="hist-body"></tbody></table></div></div>
    </div>

    <div class="col-right">
        <div class="card"><div class="card-title">MATRIZ 3D (F0-F3)</div><div id="matrix" class="matrix-grid"></div></div>
        <div class="card"><div class="card-title">ESTADO SISTEMA</div><div class="pi-grid"><div class="stat-box"><span id="ts" class="stat-val">--</span>SYNC</div><div class="stat-box"><span id="mot" class="stat-val">--</span>MOTOR</div><div class="stat-box"><span style="color:#22c55e" class="stat-val">ON</span>STATUS</div></div></div>
        
        <div class="card"><div class="card-title">VIENTO (WINDY)</div><iframe width="100%" height="130" src="https://embed.windy.com/embed2.html?lat=19.7&lon=-70.7&zoom=7&overlay=wind" frameborder="0" style="border-radius:4px;"></iframe></div>
        
        <div class="card"><div class="card-title">RADAR METEOROL√ìGICO</div><iframe width="100%" height="150" src="https://radar-met2.sna.gob.do/" frameborder="0" style="border-radius:4px;"></iframe></div>
    </div>
</div>

<script>
    const DB_URL = "https://zentinel-ia-default-rtdb.firebaseio.com/zentinel.json"; 
    let lastSyncTime = "";
    
    function verFoto(src) { 
        if (!src || src.length < 100) return; 
        document.getElementById('myModal').style.display = 'flex'; 
        document.getElementById('img01').src = src; 
    }
    
    function setG(id, v, max) { let el = document.getElementById('v' + id); let bg = document.getElementById('bg' + id); el.innerText = v; if (parseFloat(v) > max) { bg.className = 'gauge-box g-red'; } else { bg.className = 'gauge-box g-green'; } }
    
    const matrixEl = document.getElementById('matrix');
    let matrixHTML = "";
    for (let y = 0; y < 4; y++) {
        for (let x = 0; x < 6; x++) {
            matrixHTML += `<div id="F${y}_C${x}" class="cam-cell" onclick="verFoto(this.querySelector('img').src)"><img id="img_F${y}_C${x}" class="cell-thumb" src=""><div class="cam-tag">F${y}C${x}</div></div>`;
        }
    }
    matrixEl.innerHTML = matrixHTML;

    function updateHistory(d) {
        if (d.ts && d.ts !== lastSyncTime) {
            lastSyncTime = d.ts;
            const tbody = document.getElementById('hist-body');
            const row = document.createElement('tr');
            row.innerHTML = `<td>${d.ts}</td><td>${d.t}¬∞</td><td>${d.h}%</td><td>${d.n}</td><td>${d.r === 'SI' ? '‚õàÔ∏è' : '‚òÄÔ∏è'}</td>`;
            tbody.insertBefore(row, tbody.firstChild);
            if (tbody.children.length > 50) tbody.removeChild(tbody.lastChild);
        }
    }

    async function syncLoop() {
        try {
            const res = await fetch(DB_URL);
            const d = await res.json();
            if (d) {
                setG('T', d.t || "--", 30); setG('H', d.h || "--", 75); setG('N', d.n || "--", 20);
                document.getElementById('vR').innerText = (d.r == 'SI') ? '‚õàÔ∏è' : '‚òÄÔ∏è';
                document.getElementById('ts').innerText = d.ts || "--:--";
                document.getElementById('mot').innerText = d.mot || "OFF";
                
                const ban = document.getElementById('banner-ia');
                const rawBanner = d.banner || "";
                if (rawBanner.includes("danger") || rawBanner.includes("ALERTA")) ban.className = "banner-danger";
                else if (rawBanner.includes("safe") || rawBanner.includes("Normal")) ban.className = "banner-safe";
                else ban.className = "banner-neutral";
                ban.innerHTML = rawBanner;

                document.getElementById('wp').innerText = d.weather || "Sin datos";
                if (d.w_img) document.getElementById('w-img').src = "data:image/jpeg;base64," + d.w_img;
                if (d.img) document.getElementById('live').src = "data:image/jpeg;base64," + d.img;

                if (d.matrix) {
                    for (const [key, color] of Object.entries(d.matrix)) {
                        let celda = document.getElementById(key);
                        if (celda) {
                            celda.style.border = "1px solid " + color;
                            if(d.presets && d.presets[key]) {
                                let img = document.getElementById("img_" + key);
                                if(img) img.src = "data:image/jpeg;base64," + d.presets[key];
                            }
                        }
                    }
                }
                updateHistory(d);
            }
        } catch (e) { console.error("Sync Error:", e); }
    }
    setInterval(syncLoop, 2000);
    syncLoop();
    setInterval(() => { document.getElementById('clock').innerText = new Date().toLocaleTimeString(); }, 1000);
</script>
</body>
</html>
