<!DOCTYPE html>
<html lang='es'>
<head>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <title>Zentinel Cloud ðŸ‡©ðŸ‡´</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    
    <style>
        body { background: #0f172a; color: #f8fafc; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 10px; font-size: 13px; display: grid; gap: 10px; grid-template-columns: 1fr; }
        @media(min-width: 600px) { body { grid-template-columns: 1fr 1fr; } }
        
        .header { grid-column: 1 / -1; border-bottom: 2px solid #334155; padding-bottom: 5px; margin-bottom: 5px; font-size: 18px; font-weight: bold; display: flex; justify-content: space-between; }
        .card { background: #1e293b; border: 1px solid #334155; border-radius: 8px; padding: 10px; display: flex; flex-direction: column; }
        .title { color: #94a3b8; font-weight: bold; font-size: 11px; margin-bottom: 5px; text-transform: uppercase; border-bottom: 1px solid #334155; }
        
        .grid-sensors { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; }
        .sensor-box { background: #0f172a; padding: 10px; border-radius: 4px; text-align: center; border: 1px solid #334155; }
        .val { font-size: 20px; font-weight: bold; color: #38bdf8; }
        .lbl { font-size: 10px; color: #94a3b8; }
        
        .img-box { width: 100%; height: 250px; background: #000; border-radius: 4px; border: 1px solid #334155; overflow: hidden; position: relative; }
        .img-box img { width: 100%; height: 100%; object-fit: cover; }
        .overlay { position: absolute; bottom: 0; width: 100%; background: rgba(0,0,0,0.7); color: white; padding: 5px; text-align: center; font-size: 11px; }
        
        .status-row { display: flex; justify-content: space-between; font-size: 11px; margin-top: 5px; }
        .badge { padding: 2px 6px; border-radius: 3px; background: #334155; }
        .online { color: #4ade80; } .offline { color: #ef4444; }
        
        iframe { border: none; width: 100%; height: 200px; border-radius: 4px; }
    </style>
</head>
<body>

    <div class="header">
        <div>ZENTINEL <span style="color:#38bdf8">CLOUD</span></div>
        <div id="ts" style="font-size:12px; color:#94a3b8; font-family:monospace;">--:--:--</div>
    </div>

    <div class="card">
        <div class="title">SENSORES (TIEMPO REAL)</div>
        <div class="grid-sensors">
            <div class="sensor-box"><div id="t" class="val">--</div><div class="lbl">TEMP Â°C</div></div>
            <div class="sensor-box"><div id="h" class="val">--</div><div class="lbl">HUM %</div></div>
            <div class="sensor-box"><div id="n" class="val">--</div><div class="lbl">NH3 ppm</div></div>
            <div class="sensor-box"><div id="r" class="val">--</div><div class="lbl">LLUVIA</div></div>
        </div>
        <div class="status-row">
            <span>MOTOR: <b id="mot" style="color:#eab308">--</b></span>
            <span>IA: <b id="ia" class="offline">--</b></span>
        </div>
    </div>

    <div class="card">
        <div class="title">ÃšLTIMO ESCANEO VISUAL</div>
        <div class="img-box">
            <img id="snap" src="" alt="Esperando datos...">
            <div id="banner" class="overlay">Conectando...</div>
        </div>
        <div id="log" style="font-size:10px; color:#64748b; margin-top:5px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">...</div>
    </div>

    <div class="card" style="grid-column: 1 / -1;">
        <div class="title">RADAR DOMINICANO (SNA)</div>
        <iframe src="https://radar-met2.sna.gob.do/"></iframe>
    </div>

    <script>
        // 1. CONFIGURACIÃ“N FIREBASE
        var firebaseConfig = {
            databaseURL: "https://zentinel-ia-default-rtdb.firebaseio.com/"
        };
        firebase.initializeApp(firebaseConfig);

        // 2. CONEXIÃ“N BASE DE DATOS
        var db = firebase.database();
        var ref = db.ref('zentinel'); // Nodo raÃ­z donde escribe Java

        // 3. ESCUCHAR CAMBIOS
        ref.on('value', (snapshot) => {
            const data = snapshot.val();
            if(!data) return;

            // Actualizar Sensores
            document.getElementById('t').innerText = data.t;
            document.getElementById('h').innerText = data.h;
            document.getElementById('n').innerText = data.n;
            
            let isRain = data.r === "SI";
            let rEl = document.getElementById('r');
            rEl.innerText = isRain ? "SI" : "NO";
            rEl.style.color = isRain ? "#ef4444" : "#4ade80";

            // Actualizar Imagen (Si hay nueva)
            if(data.img && data.img.length > 100) {
                document.getElementById('snap').src = "data:image/jpeg;base64," + data.img;
            }

            // Actualizar Textos
            document.getElementById('banner').innerHTML = data.banner;
            document.getElementById('banner').style.background = data.banner.includes('ALERTA') ? 'rgba(239, 68, 68, 0.9)' : 'rgba(0,0,0,0.7)';
            
            document.getElementById('mot').innerText = data.mot;
            document.getElementById('log').innerText = "> " + data.log;
            document.getElementById('ts').innerText = data.ts;
            
            // Status Simulado (Si hay datos recientes, asumimos IA on)
            document.getElementById('ia').className = 'online';
            document.getElementById('ia').innerText = 'ONLINE';
        });
    </script>
</body>
</html>
