<!DOCTYPE html>
<html lang='es'>
<head>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <title>Zentinel Cloud üá©üá¥</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    
    <style>
        /* --- ESTILO EXACTO DASHBOARD LOCAL (v164) --- */
        body { background: #0f172a; color: #f8fafc; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 10px; font-size: 13px; }
        
        /* CABECERA */
        .header-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; border-bottom: 1px solid #334155; padding-bottom: 5px; }
        .header-title { font-size: 20px; font-weight: bold; }
        .header-clock { color: #94a3b8; font-family: monospace; }
        
        /* GRID PRINCIPAL (3 COLUMNAS) */
        .layout-grid { display: grid; gap: 10px; grid-template-columns: 1fr; }
        @media(min-width: 1000px) { 
            .layout-grid { grid-template-columns: 180px 1fr 300px; } /* Dise√±o original de PC */
        }

        /* TARJETAS */
        .card { background: #1e293b; border: 1px solid #334155; border-radius: 6px; padding: 8px; margin-bottom: 8px; }
        .card-title { font-size: 10px; color: #94a3b8; font-weight: bold; margin-bottom: 5px; text-transform: uppercase; border-bottom: 1px solid #334155; }

        /* RELOJES (GAUGES) */
        .gauge-box { background: #0f172a; border-radius: 50%; width: 100px; height: 100px; display: flex; flex-direction: column; align-items: center; justify-content: center; margin: 0 auto 10px auto; border: 4px solid #334155; transition: border-color 0.5s; }
        .g-green { border-color: #22c55e; color: #4ade80; }
        .g-red { border-color: #ef4444; color: #f87171; }
        .g-yellow { border-color: #eab308; color: #fde047; }
        .val-text { font-size: 22px; font-weight: bold; }
        .lbl-text { font-size: 9px; color: #94a3b8; }

        /* VIDEO & BANNER */
        .video-main { width: 100%; height: 400px; background: #000; border-radius: 6px; object-fit: cover; border: 1px solid #334155; }
        
        .banner-ia { width: 100%; margin-bottom: 5px; border-radius: 4px; overflow: hidden; font-weight:bold; font-size:12px; text-align:center; padding: 8px; }
        .banner-neutral { background:#1e293b; color:#94a3b8; border:1px solid #334155; }
        .banner-safe { background:#064e3b; color:#34d399; border:1px solid #059669; }
        .banner-warn { background:#451a03; color:#fbbf24; border:1px solid #d97706; }
        .banner-danger { background:#450a0a; color:#f87171; border:1px solid #ef4444; animation: blink 1s infinite; }
        @keyframes blink { 0% {opacity:1;} 50% {opacity:0.8;} 100% {opacity:1;} }

        /* TABLA HISTORIAL */
        table { width: 100%; border-collapse: collapse; font-size: 10px; }
        th { text-align: left; border-bottom: 1px solid #334155; color: #38bdf8; }
        td { border-bottom: 1px solid #33415555; padding: 2px; color: #94a3b8; }

        /* SISTEMA STATS */
        .pi-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 3px; font-size:9px; }
        .stat-box { background: #0f172a; padding: 4px; border-radius: 3px; text-align: center; border: 1px solid #334155; }
        .stat-val { color: #38bdf8; font-weight: bold; }

        /* CHAT / RECOMENDACIONES STYLE */
        .chat-container { height: 150px; overflow-y: auto; background: #0f172a; border: 1px solid #334155; border-radius: 4px; padding: 5px; display: flex; flex-direction: column; gap: 5px; }
        .msg-item { background: #334155; color: #e2e8f0; padding: 5px 10px; border-radius: 4px; font-size: 11px; border-left: 3px solid #38bdf8; }

        /* MAPAS */
        iframe { width: 100%; border: none; border-radius: 4px; display: block; }
        
        /* LOGS */
        .v-row { font-family: monospace; font-size: 10px; border-bottom: 1px solid #1e293b; padding: 1px; color: #94a3b8; }
        .v-row b { color: #f8fafc; }
    </style>
</head>
<body>

    <div class="header-bar">
        <div class="header-title">ZENTINEL <span style="color:#38bdf8">CLOUD</span></div>
        <div id="clock" class="header-clock">Conectando...</div>
    </div>

    <div class="layout-grid">
        
        <div class="col-left">
            <div class="card">
                <div id="bgT" class="gauge-box"><span id="vT" class="val-text">--</span><span class="lbl-text">TEMP</span></div>
                <div id="bgH" class="gauge-box"><span id="vH" class="val-text">--</span><span class="lbl-text">HUM</span></div>
                <div id="bgN" class="gauge-box"><span id="vN" class="val-text">--</span><span class="lbl-text">NH3</span></div>
                <div id="bgR" class="gauge-box"><span id="vR" style="font-size:30px;">‚òÄÔ∏è</span><span id="lR" class="lbl-text">SECO</span></div>
                <div style="text-align:center; margin-top:10px; font-size:10px; color:#94a3b8;">
                    MOTOR: <b id="mot" style="color:#eab308">--</b>
                </div>
            </div>
        </div>

        <div class="col-center">
            <div id="banner-container"></div>
            
            <img id="live" class="video-main" src="" alt="Esperando imagen de la nube...">
            
            <div class="card" style="margin-top:8px; height:120px; overflow-y:auto;">
                <div class="card-title">HISTORIAL DE MEDICIONES</div>
                <table id="hist-table">
                    <thead><tr><th>HORA</th><th>T</th><th>H</th><th>N</th><th>LLUVIA</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>

            <div class="card">
                <div class="card-title">BIT√ÅCORA INTELIGENTE (RECOMENDACIONES)</div>
                <div id="chat-box" class="chat-container">
                    <div class="msg-item">Esperando an√°lisis de la IA...</div>
                </div>
            </div>
        </div>

        <div class="col-right">
            <div class="card">
                <div class="card-title">SISTEMA</div>
                <div class="pi-grid">
                    <div class="stat-box"><span id="piIP" class="stat-val">--</span><br>IP</div>
                    <div class="stat-box"><span id="piT" class="stat-val">--</span><br>CPU</div>
                    <div class="stat-box"><span id="piR" class="stat-val">--</span><br>RAM</div>
                    <div class="stat-box"><span id="piW" class="stat-val">--</span><br>WIFI</div>
                    <div class="stat-box"><span id="piD" class="stat-val">--</span><br>DISK</div>
                    <div id="stArd" class="stat-box">--<br>ARDUINO</div>
                    <div id="stIA" class="stat-box" style="grid-column:span 3; border-color:#475569">--<br>CEREBRO IA</div>
                </div>
            </div>

            <div class="card">
                <div class="card-title">VIENTO (WINDY)</div>
                <iframe height="150" src="https://embed.windy.com/embed2.html?lat=19.780&lon=-70.687&zoom=8&level=surface&overlay=wind&menu=&message=&marker=&calendar=&pressure=&type=map&location=coordinates&detail=&detailLat=19.780&detailLon=-70.687&metricWind=km%2Fh&metricTemp=%C2%B0C&radarRange=-1"></iframe>
            </div>
            
            <div class="card">
                <div class="card-title">LLUVIA (RADAR DO)</div>
                <iframe height="200" src="https://radar-met2.sna.gob.do/"></iframe>
            </div>

            <div class="card">
                <div class="card-title">LOGS T√âCNICOS</div>
                <div id="logs" style="height:100px; overflow-y:auto;"></div>
            </div>
        </div>

    </div>

    <script>
        // üî• CONEXI√ìN A FIREBASE
        var firebaseConfig = {
            databaseURL: "https://zentinel-ia-default-rtdb.firebaseio.com/"
        };
        firebase.initializeApp(firebaseConfig);
        var ref = firebase.database().ref('zentinel');

        function setG(id, v, min, max) { 
            let el=document.getElementById('v'+id); 
            let bg=document.getElementById('bg'+id); 
            el.innerText=v; 
            let val=parseFloat(v); 
            bg.className='gauge-box '+(val>max?'g-red':val>min?'g-yellow':'g-green'); 
        }

        ref.on('value', (snapshot) => {
            const data = snapshot.val();
            if(!data) return;

            // 1. Sensores (Columna Izq)
            setG('T', data.t, 28, 30);
            setG('H', data.h, 65, 75);
            setG('N', data.n, 15, 25);
            
            let isR = data.r == 'SI';
            document.getElementById('vR').innerText = isR ? '‚õàÔ∏è' : '‚òÄÔ∏è';
            document.getElementById('lR').innerText = isR ? 'LLUVIA' : 'SECO';
            document.getElementById('bgR').className = 'gauge-box ' + (isR ? 'g-red' : 'g-green');
            
            document.getElementById('mot').innerText = data.mot;

            // 2. Centro (Imagen + Banner + Historial)
            document.getElementById('banner-container').innerHTML = data.banner;
            
            if(data.img && data.img.length > 50) {
                document.getElementById('live').src = "data:image/jpeg;base64," + data.img;
            }

            // Historial Tabla
            if(data.hist) {
                let html = "";
                data.hist.forEach(r => {
                    html += `<tr><td>${r.tm}</td><td>${r.t}</td><td>${r.h}</td><td>${r.n}</td><td>${r.r}</td></tr>`;
                });
                document.querySelector("#hist-table tbody").innerHTML = html;
            }

            // Recomendaciones (Bit√°cora)
            if(data.recs) {
                let html = "";
                data.recs.forEach(r => {
                    html += `<div class="msg-item">ü§ñ ${r}</div>`;
                });
                document.getElementById('chat-box').innerHTML = html;
            }

            // 3. Derecha (Sistema)
            document.getElementById('piIP').innerText = data.piIP || '--';
            document.getElementById('piT').innerText = data.piT || '--';
            document.getElementById('piR').innerText = data.piR || '--';
            document.getElementById('piW').innerText = data.piW || '--';
            document.getElementById('piD').innerText = data.piD || '--';
            
            let ard = data.ard;
            document.getElementById('stArd').style.color = ard ? '#4ade80' : '#ef4444';
            document.getElementById('stArd').innerText = ard ? 'ONLINE' : 'OFFLINE';

            let ia = data.iaOn;
            document.getElementById('stIA').style.color = ia ? '#4ade80' : '#ef4444';
            document.getElementById('stIA').innerText = ia ? 'ONLINE' : 'OFFLINE';

            // Logs
            // data.log viene como texto simple del √∫ltimo log, lo ponemos arriba
            // pero si queremos el historial completo como en Java, necesitamos que Java mande el HTML.
            // Por ahora, mostraremos el √∫ltimo log arriba.
            // Para simular el log visual:
            // (Nota: La versi√≥n Java v164 manda solo el √∫ltimo log en 'log' y el historial en 'histRecs' para chat.
            // Si quieres el log t√©cnico completo, necesitar√≠amos ajustar Java, pero data.banner ayuda mucho).
            
            document.getElementById('clock').innerText = "√öltima act: " + data.ts;
        });
    </script>
</body>
</html>
