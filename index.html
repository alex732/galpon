<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Capell√°n Cloud | Dashboard</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gaugeJS/dist/gauge.min.js"></script>

    <style>
        body { background: #0f172a; color: white; font-family: sans-serif; text-align: center; padding: 20px; }
        .container { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; }
        .card { background: #1e293b; padding: 20px; border-radius: 15px; width: 300px; border: 1px solid #334155; }
        .val { font-size: 2.5rem; font-weight: bold; color: #3b82f6; }
        .cam { width: 100%; border-radius: 10px; border: 2px solid #3b82f6; background: #000; }
    </style>
</head>
<body>

    <h1>CAPELL√ÅN CLOUD üêî</h1>
    <div id="conexion" style="color: #ef4444; margin-bottom: 20px; font-weight: bold;">‚óè ESTADO: CARGANDO...</div>

    <div class="container">
        <div class="card">
            <h3>AMON√çACO</h3>
            <canvas id="gauge-nh3"></canvas>
            <div id="txt-nh3" class="val">0.0</div>
        </div>

        <div class="card">
            <h3>TEMPERATURA</h3>
            <canvas id="gauge-temp"></canvas>
            <div id="txt-temp" class="val">0.0</div>
        </div>

        <div class="card">
            <h3>C√ÅMARA FOSCAM</h3>
            <img id="foscam" src="" class="cam">
        </div>
    </div>

    <script>
        // 1. ESPERAR A QUE TODO CARGUE
        window.onload = function() {
            
            // Verificaci√≥n de seguridad
            if (typeof firebase === 'undefined') {
                document.getElementById('conexion').innerText = "‚óè ERROR: LIBRER√çA NO CARGADA";
                return;
            }

            // 2. TU CONFIGURACI√ìN
            const firebaseConfig = {
                databaseURL: "https://galpon-capellan-default-rtdb.firebaseio.com"
            };
            
            // Inicializar
            firebase.initializeApp(firebaseConfig);
            const db = firebase.database();
            
            document.getElementById('conexion').innerText = "‚óè ESTADO: CONECTADO A FIREBASE";
            document.getElementById('conexion').style.color = "#22c55e";

            // 3. CONFIGURAR GAUGES
            const opts = { angle: -0.2, lineWidth: 0.2, pointer: { length: 0.6, color: '#FFF' }, staticZones: [{strokeColor: "#22c55e", min: 0, max: 20}, {strokeColor: "#ef4444", min: 20, max: 100}] };
            const gNH3 = new Gauge(document.getElementById('gauge-nh3')).setOptions(opts);
            gNH3.maxValue = 100;
            const gTemp = new Gauge(document.getElementById('gauge-temp')).setOptions(opts);
            gTemp.maxValue = 50;

            // 4. ESCUCHAR DATOS REALES
            db.ref('/').on('value', (snapshot) => {
                const data = snapshot.val();
                if(data) {
                    if(data.amoniaco !== undefined) {
                        gNH3.set(data.amoniaco);
                        document.getElementById('txt-nh3').innerText = data.amoniaco;
                    }
                    if(data.temperatura !== undefined) {
                        gTemp.set(data.temperatura);
                        document.getElementById('txt-temp').innerText = data.temperatura;
                    }
                }
            });

            // 5. CARGAR C√ÅMARA
            document.getElementById('foscam').src = "http://192.168.2.193:88/cgi-bin/CGIProxy.fcgi?cmd=getLiveStream&usr=admin&pwd=7324088";
        };
    </script>
</body>
</html>
