<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>ZENTINEL AI | GITHUB REMOTE v258</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <style>
        body{background:#0f172a; color:#f8fafc; font-family:sans-serif; margin:0; padding:0; overflow-y:auto;}
        .header{background:#020617; border-bottom:2px solid #334155; padding:10px 20px; display:flex; justify-content:space-between; align-items:center; position:sticky; top:0; z-index:900;}
        .brand{font-size:18px; font-weight:900; color:#38bdf8; letter-spacing:1px;}
        .datetime{font-family:monospace; color:#94a3b8; font-size:14px; font-weight:bold;}
        .layout{display:grid; grid-template-columns:200px 1fr 340px; gap:10px; padding:10px;}
        .col{display:flex; flex-direction:column; gap:10px;}
        .card{background:#1e293b; border:1px solid #334155; border-radius:8px; padding:10px; position:relative;}
        .card-h{font-size:11px; color:#38bdf8; font-weight:800; border-bottom:1px solid #334155; margin-bottom:8px; text-transform:uppercase;}
        .gauge-box{background:#0f172a; border-radius:50%; width:90px; height:90px; display:flex; flex-direction:column; align-items:center; justify-content:center; margin:0 auto 10px; border:4px solid #334155; transition: border-color 0.3s;}
        .g-ok{border-color:#22c55e;} .g-red{border-color:#ef4444;}
        .v-val{font-size:22px; font-weight:bold;} .v-lbl{font-size:9px; color:#94a3b8;}
        .video-main{width:100%; height:320px; background:#000; border:2px solid #334155; border-radius:4px; display:flex; align-items:center; justify-content:center; color:#334155; font-size:12px;}
        .matrix{display:grid; grid-template-columns:repeat(6,1fr); gap:2px; margin-top:5px;}
        .cam-cell{height:45px; background:#000; border:1px solid #1e293b; position:relative; overflow:hidden; border-radius:2px;}
        .cam-tag{position:absolute; bottom:0; width:100%; font-size:7px; background:#000000aa; text-align:center;}
        .banner-safe{background:#064e3b; color:#34d399; padding:8px; border-radius:4px; text-align:center; font-weight:bold; font-size:12px; margin-bottom:10px;}
        .banner-danger{background:#450a0a; color:#f87171; padding:8px; border-radius:4px; text-align:center; font-weight:bold; animation:blink 1s infinite; margin-bottom:10px;}
        .verbose{height:110px; overflow-y:auto; background:#000; font-family:monospace; font-size:10px; padding:5px; border:1px solid #334155; color:#4ade80;}
        .ia-log{height:120px; overflow-y:auto; font-size:11px; border-top:1px solid #334155; margin-top:5px; font-family:monospace; color:#f87171;}
        .chat-box{height:150px; background:#0f172a; border:1px solid #38bdf8; color:#e2e8f0; font-size:11px; padding:8px; overflow-y:auto; display:flex; flex-direction:column-reverse;}
        .stat-item{background:#0f172a; padding:5px; border-radius:4px; border:1px solid #334155; text-align:center; font-size:9px;}
        @keyframes blink{50%{opacity:0.5;}}
    </style>
</head>
<body>

    <div class="header">
        <div class="brand">ZENTINEL REMOTE v258</div>
        <div class="datetime" id="topDate">SINCRONIZANDO...</div>
    </div>

    <div class="layout">
        <div class="col">
            <div class="card">
                <div class="card-h">Sensores</div>
                <div id="bgT" class="gauge-box"><span id="vT" class="v-val">--</span><span class="v-lbl">TEMP</span></div>
                <div id="bgH" class="gauge-box"><span id="vH" class="v-val">--</span><span class="v-lbl">HUM</span></div>
                <div id="bgN" class="gauge-box"><span id="vN" class="v-val">--</span><span class="v-lbl">NH3</span></div>
                <div id="bgR" class="gauge-box"><span id="vR" style="font-size:28px">☀️</span><span class="v-lbl">LLUVIA</span></div>
            </div>
            <div class="card">
                <div class="card-h">Satélite NOAA</div>
                <img src="https://cdn.star.nesdis.noaa.gov/GOES16/ABI/SECTOR/car/GEOCOLOR/latest.jpg" style="width:100%; border-radius:4px;">
            </div>
            <div class="card">
                <div class="card-h">IA Clima Local</div>
                <div id="w-pred" style="font-size:10px; font-family:monospace; color:#38bdf8;">Esperando datos...</div>
            </div>
        </div>

        <div class="col">
            <div id="banner" class="banner-safe">ZENTINEL REMOTE ONLINE</div>
            <div class="video-main">
                [VIDEO LOCAL NO DISPONIBLE EN REMOTO]
            </div>
            <div id="matrix" class="matrix"></div>
            <div class="card">
                <div class="card-h">Terminal de Control (Solo Lectura)</div>
                <div id="chat" class="chat-box"></div>
            </div>
        </div>

        <div class="col">
            <div class="card">
                <div class="card-h">Sistema & Red</div>
                <div id="stats-box" style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:5px;">
                    <div class="stat-item"><span id="cpu">--</span><br>CPU</div>
                    <div class="stat-item"><span id="ram">--</span><br>RAM</div>
                    <div class="stat-item"><span id="dsk">--</span><br>DSK</div>
                </div>
            </div>
            <div class="card">
                <div class="card-h">Verbose Log</div>
                <div id="v-log" class="verbose"></div>
            </div>
            <div class="card">
                <div class="card-h">Alertas IA</div>
                <div id="ia-log" class="ia-log"></div>
            </div>
            <div class="card">
                <div class="card-h">Radar Dominicano</div>
                <iframe style="width:100%; height:160px; border:0;" src="https://radar-met2.sna.gob.do/"></iframe>
            </div>
            <div class="card">
                <div class="card-h">Vientos Puerto Plata</div>
                <iframe style="width:100%; height:160px; border:0;" src="https://embed.windy.com/embed2.html?lat=19.7253&lon=-70.7397&zoom=11"></iframe>
            </div>
        </div>
    </div>

    <script>
        // --- CONFIGURACIÓN FIREBASE ---
        const firebaseConfig = {
            databaseURL: "https://zentinel-ai-default-rtdb.firebaseio.com"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database().ref('status');

        // Generar Matriz Visual
        const matrixEl = document.getElementById('matrix');
        for(let y=0; y<4; y++){
            for(let x=0; x<6; x++){
                let id = `F${y}_C${x}`;
                matrixEl.innerHTML += `<div class="cam-cell" id="d_${id}"><div class="cam-tag">${id}</div></div>`;
            }
        }

        // --- ESCUCHA EN TIEMPO REAL ---
        db.on('value', (snapshot) => {
            const d = snapshot.val();
            if(!d) return;

            // Header y Fecha
            document.getElementById('topDate').innerText = d.lastUpdate || "--:--:--";

            // Sensores (Gauges)
            updateGauge('T', d.temp, 32);
            updateGauge('H', d.hum, 75);
            updateGauge('N', d.nh3, 25);
            document.getElementById('vR').innerText = d.rain === "SI" ? "⛈️" : "☀️";
            document.getElementById('bgR').className = "gauge-box " + (d.rain === "SI" ? "g-red" : "g-ok");

            // Banner IA
            const banner = document.getElementById('banner');
            const isAlert = d.iaAlert && (d.iaAlert.includes("ALERTA") || d.iaAlert.includes("MUERTO"));
            banner.className = isAlert ? "banner-danger" : "banner-safe";
            banner.innerText = d.iaAlert || "SISTEMA NORMAL";

            // Stats
            document.getElementById('cpu').innerText = d.cpu || "--";
            document.getElementById('ram').innerText = d.ram || "--";
            document.getElementById('dsk').innerText = d.disk || "--";

            // Logs y Clima
            document.getElementById('w-pred').innerText = d.weather || "Analizando...";
            if(d.iaAlert) document.getElementById('ia-log').innerHTML = `<div>${d.iaAlert}</div>` + document.getElementById('ia-log').innerHTML;
        });

        function updateGauge(id, val, max) {
            const el = document.getElementById('v' + id);
            const box = document.getElementById('bg' + id);
            const num = parseFloat(val);
            el.innerText = val + (id === 'N' ? "" : (id === 'T' ? "°" : "%"));
            box.className = "gauge-box " + (num > max ? "g-red" : "g-ok");
        }
    </script>
</body>
</html>
